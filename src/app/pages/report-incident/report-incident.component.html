<div class="max-w-xl mx-auto p-6">
  <h1 class="text-2xl font-bold text-gray-800 mb-4">ðŸš¨ Report an Incident</h1>

  <form [formGroup]="incidentForm" (ngSubmit)="submitIncident()" class="space-y-5">
    <!-- Description -->
    <div>
      <label class="block mb-1 text-gray-700 font-medium">Incident Description</label>
      <textarea
        formControlName="description"
        rows="4"
        placeholder="Describe what happened..."
        class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-green-600 focus:border-transparent"
      ></textarea>

      <p *ngIf="incidentForm.get('description')?.invalid && incidentForm.get('description')?.touched"
         class="text-red-500 text-sm mt-1">
        A brief description is required (min 10 characters).
      </p>
    </div>

    <!-- File Uploader -->
    <div>
      <label class="block mb-1 text-gray-700 font-medium">Upload Photos</label>
      <app-file-uploader
        (uploadSuccessfulEvent)="onImageUploaded($event)"
        (uploadErrorEvent)="onUploadError()"
      ></app-file-uploader>
    </div>

    <!-- Uploaded Images Preview -->
    <div *ngIf="photoUrls.length > 0" class="grid grid-cols-3 gap-3 mt-4">
      <div *ngFor="let photo of photoUrls" class="relative group">
        <img
          [src]="photo"
          class="w-full h-32 object-cover rounded-lg border border-gray-300"
        />
        <button
          type="button"
          (click)="removePhoto(photo)"
          class="absolute top-1 right-1 bg-red-600 text-white rounded-full w-6 h-6 flex items-center justify-center opacity-80 hover:opacity-100">
          &times;
        </button>
      </div>
    </div>

    <!-- Submit Button -->
    <button
      type="submit"
      [disabled]="submitting || incidentForm.invalid"
      class="w-full bg-green-700 text-white py-2 px-4 rounded-lg font-semibold shadow hover:bg-green-800 disabled:opacity-50 transition">
      <span *ngIf="!submitting">Submit Report</span>
      <div *ngIf="submitting" class="flex justify-center items-center space-x-2">
        <svg class="animate-spin h-5 w-5 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
          <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
          <path class="opacity-75" fill="currentColor"
                d="M4 12a8 8 0 018-8v8z"></path>
        </svg>
        <span>Submitting...</span>
      </div>
    </button>

  </form>
</div>
