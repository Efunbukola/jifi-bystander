<div class="p-4 h-screen overflow-y-auto pb-[120px]">

   <div class="flex justify-between items-center mb-4">
    <h2 class="text-lg font-semibold text-gray-700 dark:text-gray-200">
      My Profile
    </h2>

    <button
      (click)="signOut()"
      class="text-red-600 hover:text-red-700 font-semibold text-sm flex items-center gap-1 transition-colors"
    >
      <svg
        xmlns="http://www.w3.org/2000/svg"
        class="w-4 h-4"
        fill="none"
        viewBox="0 0 24 24"
        stroke="currentColor"
        stroke-width="2"
      >
        <path
          stroke-linecap="round"
          stroke-linejoin="round"
          d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a2 2 0 01-2 2H7a2 2 0 01-2-2V7a2 2 0 012-2h4a2 2 0 012 2v1"
        />
      </svg>
      Sign Out
    </button>
  </div>

  <!-- Profile Form -->
  <form [formGroup]="form" (ngSubmit)="saveProfile()" class="space-y-4 mb-8">
    <div class="grid grid-cols-1 gap-4">
      <div class="grid grid-cols-2 gap-4">
        <input formControlName="first_name" placeholder="First Name" class="border rounded-lg px-3 py-2 pr-10" />
        <input formControlName="last_name" placeholder="Last Name" class="border rounded-lg px-3 py-2 pr-10" />
      </div>

      <input formControlName="username" placeholder="Username" class="border rounded-lg px-3 py-2 pr-10" />
      <input formControlName="email" placeholder="Email" class="border rounded-lg px-3 py-2 pr-10" />

      <div class="grid grid-cols-2 gap-4">
        <input formControlName="occupation" placeholder="Occupation" class="border rounded-lg px-3 py-2 pr-10" />
        <input formControlName="company" placeholder="Company" class="border rounded-lg px-3 py-2 pr-10" />
      </div>

      <div class="grid grid-cols-3 gap-4">
        <input formControlName="city" placeholder="City" class="border rounded-lg px-3 py-2 pr-10" />
        <input formControlName="state" placeholder="State" class="border rounded-lg px-3 py-2 pr-10" />
        <input formControlName="zip_code" placeholder="Zip Code" class="border rounded-lg px-3 py-2 pr-10" />
      </div>
    </div>

    <button
      type="submit"
      [disabled]="loading"
      class="w-full bg-green-700 text-white font-semibold py-2 rounded-md hover:bg-green-800"
    >
      {{ loading ? 'Saving...' : 'Update profile' }}
    </button>
  </form>

  <p *ngIf="message" class="text-green-600 mt-3 font-medium">{{ message }}</p>

  <!-- Divider -->
  <hr class="my-6 border-gray-300 dark:border-gray-700" />

  <!-- ðŸ”’ Password Update Section -->
  <h3 class="text-md font-semibold mb-2 text-gray-700 dark:text-gray-200">
    Change Password
  </h3>

  <form [formGroup]="passwordForm" (ngSubmit)="updatePassword()" class="space-y-4">
    <div>
      <input
        type="password"
        formControlName="current_password"
        placeholder="Current Password"
        class="border rounded-lg px-3 py-2 w-full"
      />
    </div>

    <div class="relative">
      <input
        [type]="showNewPassword ? 'text' : 'password'"
        formControlName="new_password"
        placeholder="New Password"
        class="border rounded-lg px-3 py-2 w-full pr-10"
      />
      <button
        type="button"
        (click)="togglePasswordVisibility()"
        class="absolute inset-y-0 right-2 flex items-center text-gray-500"
      >
        <svg
          *ngIf="!showNewPassword"
          xmlns="http://www.w3.org/2000/svg"
          height="20"
          width="20"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          stroke-width="2"
          stroke-linecap="round"
          stroke-linejoin="round"
          class="w-5 h-5"
        >
          <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8S1 12 1 12z" />
          <circle cx="12" cy="12" r="3" />
        </svg>

        <svg
          *ngIf="showNewPassword"
          xmlns="http://www.w3.org/2000/svg"
          height="20"
          width="20"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          stroke-width="2"
          stroke-linecap="round"
          stroke-linejoin="round"
          class="w-5 h-5"
        >
          <path d="M17.94 17.94A10.94 10.94 0 0112 20C5 20 1 12 1 12a21.91 21.91 0 014.66-5.68M9.9 4.24A10.94 10.94 0 0112 4c7 0 11 8 11 8a22.1 22.1 0 01-4.35 5.44M1 1l22 22" />
        </svg>
      </button>
    </div>

    <button
      type="submit"
      [disabled]="loading"
      class="w-full bg-green-700 text-white font-semibold py-2 rounded-md hover:bg-green-800"
    >
      {{ loading ? 'Updating...' : 'Update Password' }}
    </button>

    <p *ngIf="passwordMessage" class="text-green-600 mt-3 font-medium">
      {{ passwordMessage }}
    </p>
  </form>

  <!-- MANAGE PAYMENT METHODS -->
<hr class="my-6 border-gray-300" />

<h3 class="text-md font-semibold mb-2">Payment Methods</h3>

<!-- Global loading spinner -->
<div *ngIf="cardsLoading" class="flex items-center gap-2 text-gray-600">
  <svg
    class="animate-spin h-5 w-5 text-green-700"
    xmlns="http://www.w3.org/2000/svg"
    fill="none"
    viewBox="0 0 24 24"
  >
    <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
    <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8v8z"></path>
  </svg>
  Loading cards...
</div>

<div *ngIf="savedCards.length === 0 && !cardsLoading" class="text-gray-500">
  No saved cards. Add one below.
</div>

<div
  *ngFor="let card of savedCards"
  class="border p-3 rounded-lg mb-2 flex justify-between items-center"
>
  <div>
    <p class="font-semibold">
      {{ card.card.brand | titlecase }} â€¢â€¢â€¢â€¢ {{ card.card.last4 }}
    </p>

    <p class="text-sm text-gray-600">
      Expires {{ card.card.exp_month }}/{{ card.card.exp_year }}
    </p>

    <!-- Default badge -->
    <p
      *ngIf="defaultPaymentMethod === card.id"
      class="inline-block mt-1 px-2 py-1 text-xs bg-green-100 text-green-700 rounded-md"
    >
      Default
    </p>
  </div>

  <div class="flex gap-2">

    <!-- Set Default Button -->
    <button
      (click)="setDefault(card.id)"
      [disabled]="settingDefaultId === card.id"
      class="text-blue-600 text-sm relative"
    >
      <span *ngIf="settingDefaultId !== card.id">Set Default</span>

      <!-- Spinner -->
      <svg
        *ngIf="settingDefaultId === card.id"
        class="animate-spin h-4 w-4 text-blue-600"
        xmlns="http://www.w3.org/2000/svg"
        fill="none"
        viewBox="0 0 24 24"
      >
        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
        <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8v8z"></path>
      </svg>
    </button>

    <!-- Delete Button -->
    <button
      (click)="deleteCard(card.id)"
      [disabled]="deletingCardId === card.id"
      class="text-red-600 text-sm relative"
    >
      <span *ngIf="deletingCardId !== card.id">Delete</span>

      <!-- Spinner -->
      <svg
        *ngIf="deletingCardId === card.id"
        class="animate-spin h-4 w-4 text-red-600"
        xmlns="http://www.w3.org/2000/svg"
        fill="none"
        viewBox="0 0 24 24"
      >
        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
        <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8v8z"></path>
      </svg>
    </button>

  </div>
</div>

<!-- Add New Card -->
<button
  (click)="startAddCard()"
  [disabled]="addingCard"
  class="mt-4 bg-green-700 text-white py-2 px-4 rounded-md flex items-center justify-center gap-2"
>
  <span *ngIf="!addingCard">+ Add New Card</span>

  <svg
    *ngIf="addingCard"
    class="animate-spin h-5 w-5 text-white"
    xmlns="http://www.w3.org/2000/svg"
    fill="none"
    viewBox="0 0 24 24"
  >
    <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
    <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8v8z"></path>
  </svg>
</button>

<div *ngIf="addingCard && setupClientSecret" class="mt-4 border p-4 rounded-lg">
  <app-stripe-add-card
    [clientSecret]="setupClientSecret"
    (completed)="onCardAdded()"
  ></app-stripe-add-card>
</div>

<hr class="my-6 border-gray-300" />

<h3 class="text-md font-semibold mb-2 text-red-600">
  Deactivate Account
</h3>

<button
  (click)="confirmDeactivate()"
  class="w-full bg-red-600 text-white py-2 rounded-md hover:bg-red-700 font-semibold"
>
  Deactivate My Account
</button>



</div>
